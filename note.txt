aws eks update-kubeconfig --region us-east-1 --name project3

## Apply env variables and secrets
kubectl apply -f aws-secret.yaml
kubectl apply -f env-secret.yamlkubectl apply -f env-secret.yaml
kubectl apply -f env-configmap.yaml
## Deployments - Double check the Dockerhub image name and version in the deployment files
kubectl apply -f backend-feed-deployment.yaml
## Do the same for other three deployment files
## Service
kubectl apply -f backend-feed-service.yaml
## Do the same for other three service files

kubectl apply -f backend-user-deployment.yaml
kubectl apply -f backend-user-service.yaml
kubectl describe pod ....

kubectl apply -f reverseproxy-deployment.yaml
kubectl apply -f reverseproxy-service.yaml

kubectl apply -f frontend-deployment.yaml
kubectl apply -f frontend-service.yaml

kubectl expose deployment frontend --type=LoadBalancer --name=publicfrontend
kubectl expose deployment reverseproxy --type=LoadBalancer --name=publicreverseproxy

docker build . -t duylkend/udagram-frontend:v5
docker push duylkend/udagram-frontend:v5
kubectl set image deployment frontend frontend=duylkend/udagram-frontend:v5

## Kubernetes pods are deployed properly
kubectl get pods 
## Kubernetes services are set up properly
kubectl describe services
## You have horizontal scaling set against CPU usage
kubectl describe hpa

kubectl delete service publicfrontend
kubectl delete service frontend
kubectl delete service backend-feed
kubectl delete service backend-user
kubectl delete service reverseproxy
kubectl delete service publicreverseproxy

kubectl delete deployments/frontend
kubectl delete deployments/backend-user
kubectl delete deployments/backend-feed
kubectl delete deployments/reverseproxy


kubectl get services

kubectl autoscale deployment backend-user --cpu-percent=50 --min=2 --max=3

kubectl apply -f https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml

kubectl get deployment metrics-server -n kube-system

kubectl delete hpa hpa-backend-feed

kubectl describe hpa hpa-backend-feed

https://docs.aws.amazon.com/eks/latest/userguide/metrics-server.html
